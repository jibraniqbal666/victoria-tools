version: '3.8'

services:
  victoria-tools:
    build:
      context: .
      dockerfile: Dockerfile
    image: victoria-tools:latest
    ports:
      - "3000:8080"
    environment:
      - PORT=8080
      - VMALERT_PATH=/usr/local/bin/vmalert
      - NODE_ENV=production
    volumes:
      # Mount rules directory if needed
      - ./rules:/app/rules:ro
    networks:
      - victoria-network
    restart: unless-stopped

  # Optional: vmalert service for running alerts (separate from replay functionality)
  # The victoria-tools container has its own vmalert binary for replay
  # Uncomment if you need a separate vmalert instance for alerting
  # vmalert:
  #   image: victoriametrics/vmalert:latest
  #   volumes:
  #     - ./rules:/rules:ro
  #   command:
  #     - -rule=/rules/*.yml
  #     - -datasource.url=http://localhost:8428
  #   networks:
  #     - victoria-network

networks:
  victoria-network:
    driver: bridge

